---
source: crates/ignis_codegen_c/tests/golden_c.rs
expression: c_code
---
#include "types.h"

// Type forward declarations
typedef struct Resource Resource;

// Type definitions
struct Resource {
    i32 field_0;
    uint8_t __ignis_drop_state;
};

void Resource_drop(struct Resource* self);
void __ignis_user_main(void);

void Resource_drop(struct Resource* self) {
    // Locals
    struct Resource* l0; // self

    // Temporaries
    struct Resource* t0;

entry_0:
    l0 = self;
    return;
}

void __ignis_user_main(void) {
    // Locals
    struct Resource l0; // r

    // Temporaries
    struct Resource* t0;
    struct Resource* t1;

entry_0:
    t0 = &l0;
    (t0)->field_0 = 1;
    (t0)->__ignis_drop_state = 0;
    t1 = &l0;
    if ((t1)->__ignis_drop_state) { fprintf(stderr, "panic: use of dropped value\n"); exit(101); }
    Resource_drop(t1);
    (t1)->__ignis_drop_state = 1;
    return;
}

int main(int argc, char** argv) {
    (void)argc;
    (void)argv;
    __ignis_user_main();
    return 0;
}
